<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="baidu-site-verification" content="LJgfOWhkKl" />



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="nginx,https,ssl," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="问题移动端最近反应分享到微信的链接有时候打不开有时候打得开，具体报错如下。只有Android有问题，IOS没有问题，通过Android浏览器发现如下报错">
<meta name="keywords" content="nginx,https,ssl">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx https 此服务器无法证明其所在网域">
<meta property="og:url" content="http://vincentblog.cn/Nginx-https-此服务器无法证明其所在网域.html">
<meta property="og:site_name" content="Vincent Blog">
<meta property="og:description" content="问题移动端最近反应分享到微信的链接有时候打不开有时候打得开，具体报错如下。只有Android有问题，IOS没有问题，通过Android浏览器发现如下报错">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/6e9a4d0bgy1fgypskckfdj20dj0o042c.jpg">
<meta property="og:updated_time" content="2018-08-22T01:39:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nginx https 此服务器无法证明其所在网域">
<meta name="twitter:description" content="问题移动端最近反应分享到微信的链接有时候打不开有时候打得开，具体报错如下。只有Android有问题，IOS没有问题，通过Android浏览器发现如下报错">
<meta name="twitter:image" content="http://ww1.sinaimg.cn/large/6e9a4d0bgy1fgypskckfdj20dj0o042c.jpg">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 9929411,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://vincentblog.cn/Nginx-https-此服务器无法证明其所在网域.html"/>


  <title> Nginx https 此服务器无法证明其所在网域 | Vincent Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?e78a7a36dc0c97807b01e08b672686f4";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  <div style="display: none;">
    <script src="http://s95.cnzz.com/z_stat.php?id=1260196456&web_id=1260196456" language="JavaScript"></script>
  </div>





  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Vincent Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            留言
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Nginx https 此服务器无法证明其所在网域
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-26T17:40:16+08:00" content="2017-06-26">
              2017-06-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/nginx/" itemprop="url" rel="index">
                    <span itemprop="name">nginx</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>移动端最近反应分享到微信的链接有时候打不开有时候打得开，具体报错如下。只有Android有问题，IOS没有问题，通过Android浏览器发现如下报错</p>
<p><img src="http://ww1.sinaimg.cn/large/6e9a4d0bgy1fgypskckfdj20dj0o042c.jpg" alt=""></p>
<a id="more"></a>
<p>开发在代码里面打印出的报错日志如下<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">primary <span class="string">error:</span> <span class="number">3</span> <span class="string">certificate:</span> Issued <span class="string">to:</span> CN=*.example.com,C=CN;</span><br><span class="line">                                                     Issued <span class="string">by:</span> CN=Certum Domain Validation CA SHA2,OU=Certum Certification Authority,O=Unizeto Technologies S.A.,C=PL;</span><br><span class="line">                                                      on <span class="string">URL:</span> <span class="string">https:</span><span class="comment">//example.com/</span></span><br></pre></td></tr></table></figure></p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>发现这个问题后因为也是头一次碰到所以赶紧google，看看有没有大神能帮忙结局。结果所有解决办法都是说在代码层面添加一段代码。但是开发已经加了还是有问题。折腾了有大半天，突然想到去看看之前外包的Apache SSL 配置文件。发现有一项配置<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">SSLCertificateChainFile</span> <span class="string">"/etc/ssl/bundle.crt"</span></span><br></pre></td></tr></table></figure></p>
<p>在Nginx里面是没有配的。于是赶紧又google，找到了nginx官网的文档。</p>
<p><a href="http://nginx.org/en/docs/http/configuring_https_servers.html" target="_blank" rel="noopener">http://nginx.org/en/docs/http/configuring_https_servers.html</a></p>
<p>里面有这么一段话</p>
<blockquote>
<p>SSL certificate chains<br>Some browsers may complain about a certificate signed by a well-known certificate authority, while other browsers may accept the certificate without issues. This occurs because the issuing authority has signed the server certificate using an intermediate certificate that is not present in the certificate base of well-known trusted certificate authorities which is distributed with a particular browser. In this case the authority provides a bundle of chained certificates which should be concatenated to the signed server certificate. The server certificate must appear before the chained certificates in the combined file:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat www<span class="selector-class">.example</span><span class="selector-class">.com</span><span class="selector-class">.crt</span> bundle<span class="selector-class">.crt</span> &gt; www<span class="selector-class">.example</span><span class="selector-class">.com</span><span class="selector-class">.chained</span><span class="selector-class">.crt</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>The resulting file should be used in the ssl_certificate directive:<br><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen              <span class="number">443</span> ssl<span class="comment">;</span></span><br><span class="line">    server_name         www.example.com<span class="comment">;</span></span><br><span class="line">    ssl_certificate     www.example.com.chained.crt<span class="comment">;</span></span><br><span class="line">    ssl_certificate_key www.example.com.key<span class="comment">;</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>If the server certificate and the bundle have been concatenated in the wrong order, nginx will fail to start and will display the error message:<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SSL_CTX_use_PrivateKey_file(<span class="string">" ... /www.example.com.key"</span>) failed</span><br><span class="line">   (SSL: <span class="built_in">error</span>:<span class="number">0B080074</span>:x509 certificate routines:</span><br><span class="line">    X509_check_private_key:<span class="built_in">key</span> <span class="built_in">values</span> mismatch)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>because nginx has tried to use the private key with the bundle’s first certificate instead of the server certificate.</p>
</blockquote>
<h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><p>按照官档的说明，大致的意思是有些浏览器还需要中间证书的支持，不然就会报错。这也正好印证了我之前的分析Apache的那段配置。赶紧按照官档重新生成了证书</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat www<span class="selector-class">.example</span><span class="selector-class">.com</span><span class="selector-class">.crt</span> bundle<span class="selector-class">.crt</span> &gt; www<span class="selector-class">.example</span><span class="selector-class">.com</span><span class="selector-class">.chained</span><span class="selector-class">.crt</span></span><br></pre></td></tr></table></figure>
<p>记住顺序不能错，然后把nginx配置的证书修改一下<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">ssl_certificate /etc/ssl/www<span class="selector-class">.example</span><span class="selector-class">.com</span><span class="selector-class">.chained</span><span class="selector-class">.crt</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>重新加载配置之后不再有报错了。大功告成！<br>å</p>
<h1 id="SLB-证书格式报错"><a href="#SLB-证书格式报错" class="headerlink" title="SLB 证书格式报错"></a>SLB 证书格式报错</h1><p>因为是通过SLB做的Https，所以要把证书放到SLB上，但是又报错说证书格式错误。</p>
<p>看到阿里云这篇文档，因为证书里面不能有空行，把空行解决就不会有问题了。</p>
<p><a href="https://help.aliyun.com/document_detail/32332.html?spm=5176.doc32336.2.3.2i8bTn" target="_blank" rel="noopener">https://help.aliyun.com/document_detail/32332.html?spm=5176.doc32336.2.3.2i8bTn</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>赏</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="uploads/wechatpay.jpg" alt="Vincent WeChat Pay"/>
          <p>微信打赏</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="uploads/alipay.jpg" alt="Vincent Alipay"/>
          <p>支付宝打赏</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/nginx/" rel="tag">#nginx</a>
          
            <a href="/tags/https/" rel="tag">#https</a>
          
            <a href="/tags/ssl/" rel="tag">#ssl</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/自定义Shell终端提示符.html" rel="next" title="自定义Shell终端提示符">
                <i class="fa fa-chevron-left"></i> 自定义Shell终端提示符
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/ES模板报错-Template-variables-could-not-be-initialized.html" rel="prev" title="Grafana ES模板报错  Template variables could not be initialized">
                Grafana ES模板报错  Template variables could not be initialized <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/vincent.png"
               alt="Vincent" />
          <p class="site-author-name" itemprop="name">Vincent</p>
          <p class="site-description motion-element" itemprop="description">为了无法计算的价值</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">78</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">88</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/vincent927" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/liuhuan19910927" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#问题"><span class="nav-number">1.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#分析"><span class="nav-number">2.</span> <span class="nav-text">分析</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#解决"><span class="nav-number">3.</span> <span class="nav-text">解决</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SLB-证书格式报错"><span class="nav-number">4.</span> <span class="nav-text">SLB 证书格式报错</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Vincent</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io" rel="external nofollow">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Muse
  </a>
</div>

<div>
<a href="http://www.miitbeian.gov.cn/" rel="external nofollow">粤ICP备16107811号</a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
